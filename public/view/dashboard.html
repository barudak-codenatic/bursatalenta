<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard - Bursa Talenta</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <!-- Navbar Component -->
    <script src="/components/navbar-component.js"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Figtree', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'sans-serif'],
                    },
                    colors: {
                        'custom-green': '#85B073',
                        'custom-blue': '#003D68',
                        'custom-gray': '#D9D9D9'
                    }
                }
            }
        }
    </script>
</head>

<body class="font-sans antialiased bg-gray-50">
    <!-- Navigation -->
    <navbar-component active-page="dashboard"></navbar-component>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Selamat datang, John!</h1>
            <p class="text-gray-600">Temukan peluang karir terbaik untuk Anda</p>
        </div>

        <!-- Search and Filter Section -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0 sm:space-x-4 mb-8 p-4 border border-gray-300 rounded-lg bg-white">
            <!-- Filter Box -->
            <div class="relative">
                <select id="categoryFilter" onchange="filterJobs()" 
                    class="border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none min-w-[150px]">
                    <option value="">Semua Kategori</option>
                    <option value="Full Time">Full Time</option>
                    <option value="Part Time">Part Time</option>
                    <option value="Contract">Contract</option>
                    <option value="Freelance">Freelance</option>
                    <option value="Internship">Internship</option>
                </select>
                <!-- Dropdown arrow -->
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </div>

            <!-- Search Box -->
            <div class="relative w-full max-w-md">
                <input type="text" id="searchInput" placeholder="Cari lowongan kerja..." onkeyup="searchJobs()"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2 pl-10 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <!-- Search icon -->
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Job Cards Grid -->
        <div id="jobGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Loading State -->
            <div id="loadingState" class="col-span-full flex justify-center items-center py-12">
                <div class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-custom-blue mb-4"></div>
                    <p class="text-gray-600">Memuat lowongan kerja...</p>
                </div>
            </div>
            <!-- Jobs will be inserted here dynamically -->
        </div>

        </div>

        <!-- No Results Message -->
        <div id="noResults" class="hidden text-center py-12">
            <h3 class="text-lg font-medium text-gray-900 mb-2">Tidak ada lowongan ditemukan</h3>
            <p class="text-gray-500">Coba ubah filter atau kata kunci pencarian Anda</p>
        </div>
    </main>

    <script>
        // Global variables to store jobs data
        let allJobs = [];
        let filteredJobs = [];

        // Fetch jobs from API using axios
        async function fetchJobs() {
            try {
                const response = await axios.get('/api/jobs');
                const data = response.data;
                allJobs = data.jobs || data; // Handle different response formats
                filteredJobs = [...allJobs];
                displayJobs();
            } catch (error) {
                console.error('Error fetching jobs:', error);
                
                if (error.response) {
                    // Server responded with error status
                    showError(`Gagal memuat data lowongan kerja. Status: ${error.response.status}`);
                } else if (error.request) {
                    // Request was made but no response received
                    showError('Tidak dapat terhubung ke server. Periksa koneksi internet Anda.');
                } else {
                    // Something else happened
                    showError('Gagal memuat data lowongan kerja. Silakan coba lagi.');
                }
            }
        }

        // Display jobs in cards
        function displayJobs() {
            const loadingState = document.getElementById('loadingState');
            const jobGrid = document.getElementById('jobGrid');
            const noResults = document.getElementById('noResults');

            // Hide loading state
            loadingState.classList.add('hidden');
            
            // Clear existing job cards first (keep loading state)
            const existingCards = jobGrid.querySelectorAll('.job-card');
            existingCards.forEach(card => card.remove());
            
            if (filteredJobs.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }

            // Hide no results
            noResults.classList.add('hidden');

            // Create job cards
            filteredJobs.forEach(job => {
                const jobCard = createJobCard(job);
                jobGrid.appendChild(jobCard);
            });
        }

        // Create job card element
        function createJobCard(job) {
            const card = document.createElement('div');
            card.className = 'job-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow';
            
            // Create type badge with different colors based on type
            let typeBadgeColor = 'bg-green-500';
            if (job.type === 'Part Time') {
                typeBadgeColor = 'bg-blue-500';
            } else if (job.type === 'Contract') {
                typeBadgeColor = 'bg-orange-500';
            } else if (job.type === 'Freelance') {
                typeBadgeColor = 'bg-purple-500';
            } else if (job.type === 'Internship') {
                typeBadgeColor = 'bg-yellow-500';
            }
            
            const typeBadge = `<span class="${typeBadgeColor} text-white text-xs px-2 py-1 rounded-full font-medium">${job.type}</span>`;

            const salary = job.salary ? `Rp ${parseInt(job.salary).toLocaleString('id-ID')}` : 'Tidak disebutkan';
            
            // Use default image if no image provided
            const imageUrl = job.image || '/assets/logo.png';
            
            card.innerHTML = `
                <div class="p-4 bg-gray-50 relative">
                    <div class="flex justify-center items-center h-32">
                        <img src="${imageUrl}" alt="${job.title}" class="h-full w-full object-cover rounded-lg">
                    </div>
                </div>

                <div class="p-4 bg-white">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-900 text-sm">${job.title}</h3>
                        ${typeBadge}
                    </div>

                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v12a1 1 0 01-1 1H4a1 1 0 01-1-1V4z M5 6h10v2H5V6z M5 10h10v2H5v-2z" />
                            </svg>
                            ${job.company_name}
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                            </svg>
                            ${job.location}
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd" />
                            </svg>
                            ${salary}
                        </div>
                    </div>

                    <button onclick="viewJobDetail(${job.id})"
                        class="w-full bg-custom-blue hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors text-sm">
                        LAMAR SEKARANG
                    </button>
                </div>
            `;
            
            return card;
        }

        // Show error message
        function showError(message) {
            const loadingState = document.getElementById('loadingState');
            loadingState.innerHTML = `
                <div class="flex flex-col items-center">
                    <p class="text-red-600">${message}</p>
                    <button onclick="fetchJobs()" class="mt-4 bg-custom-blue text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Coba Lagi
                    </button>
                </div>
            `;
        }

        // Search functionality
        function searchJobs() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            filteredJobs = allJobs.filter(job => {
                const matchesSearch = 
                    job.title.toLowerCase().includes(searchTerm) ||
                    job.company_name.toLowerCase().includes(searchTerm) ||
                    (job.description && job.description.toLowerCase().includes(searchTerm)) ||
                    (job.location && job.location.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryFilter || job.type === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
            
            displayJobs();
        }

        // Filter functionality
        function filterJobs() {
            searchJobs(); // Reuse search logic for filtering
        }

        // Apply for job
        function applyJob(jobTitle, company) {
            alert(`Anda akan melamar untuk posisi: ${jobTitle} di ${company}\n\nFitur ini akan segera tersedia!`);
        }

        // View job detail
        function viewJobDetail(jobId) {
            // Navigate to job detail page
            window.location.href = `/view/job-detail.html?id=${jobId}`;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch jobs data
            fetchJobs();
        });
    </script>
</body>

</html>
