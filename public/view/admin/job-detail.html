<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="dummy-csrf-token">
    <title>Bursa Talenta - Detail Lowongan</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=figtree:400,500,600,700&display=swap" rel="stylesheet" />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Axios CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Figtree', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'sans-serif'],
                    },
                    colors: {
                        'custom-blue': '#3b82f6',
                    }
                }
            }
        }
    </script>

    <!-- Components -->
    <script src="/components/admin-navbar-component.js"></script>
    <script src="/components/admin-sidebar-component.js"></script>
</head>

<body class="font-sans antialiased bg-gray-50">
    <div class="min-h-screen">
        <!-- Navigation -->
        <admin-navbar-component active-page="job-management"></admin-navbar-component>
        
        <!-- Main Content -->
        <div class="flex">
            <!-- Sidebar -->
            <admin-sidebar-component active-page="job-management"></admin-sidebar-component>

            <!-- Content Area -->
            <div class="flex-1">
                <div class="py-6">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <!-- Breadcrumb -->
                        <nav class="flex mb-5" aria-label="Breadcrumb">
                            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                                <li class="inline-flex items-center">
                                    <a href="/admin-dashboard" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                                        </svg>
                                        Dashboard
                                    </a>
                                </li>
                                <li>
                                    <div class="flex items-center">
                                        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        <a href="/view/admin/job-management.html" class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2">Manajemen Lowongan</a>
                                    </div>
                                </li>
                                <li aria-current="page">
                                    <div class="flex items-center">
                                        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">Detail Lowongan</span>
                                    </div>
                                </li>
                            </ol>
                        </nav>

                        <!-- Success/Error Messages -->
                        <div id="successMessage" class="mb-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative hidden" role="alert">
                            <span class="block sm:inline" id="successText"></span>
                        </div>

                        <div id="errorMessage" class="mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative hidden" role="alert">
                            <span class="block sm:inline" id="errorText"></span>
                        </div>

                        <!-- Loading Indicator -->
                        <div id="loadingIndicator" class="mb-6 text-center">
                            <div class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Memuat data...
                            </div>
                        </div>

                        <!-- Job Detail Content -->
                        <div id="jobDetailContent" class="hidden">
                            <!-- Job Header -->
                            <div class="bg-white rounded-lg shadow-sm mb-6">
                                <div class="p-8">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h1 id="jobTitle" class="text-2xl font-bold text-gray-900 mb-2">Loading...</h1>
                                            <p id="companyName" class="text-lg text-gray-600">Loading...</p>
                                        </div>
                                        <div class="flex space-x-3">
                                            <button onclick="editJob()" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </button>
                                            <button onclick="deleteJob()" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                                <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Hapus
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Job Content -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <!-- Left Column: Job Description + Applicants -->
                                <div class="md:col-span-2 space-y-6">
                                    <!-- Job Description -->
                                    <div class="bg-white rounded-lg shadow-sm p-8">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Deskripsi Pekerjaan</h2>
                                        <div id="jobDescription" class="prose max-w-none">
                                            <p>Loading...</p>
                                        </div>
                                    </div>

                                    <!-- Applicants Section -->
                                    <div class="bg-white rounded-lg shadow-sm p-8">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Daftar Pelamar</h2>
                                        
                                        <!-- Applicants Stats -->
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 bg-blue-100 rounded-md p-3">
                                                        <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                        </svg>
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-500">Total Pelamar</div>
                                                        <div id="totalApplicants" class="text-lg font-semibold text-gray-900">0</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Applicants Table -->
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full divide-y divide-gray-200">
                                                <thead class="bg-gray-50">
                                                    <tr>
                                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Pelamar</th>
                                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal Melamar</th>
                                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ekspektasi Gaji</th>
                                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="applicantsTableBody" class="bg-white divide-y divide-gray-200">
                                                    <!-- Applicants data will be loaded dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Empty State for No Applicants -->
                                        <div id="noApplicantsMessage" class="hidden text-center py-8">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                            </svg>
                                            <h3 class="mt-2 text-sm font-medium text-gray-900">Belum ada pelamar</h3>
                                            <p class="mt-1 text-sm text-gray-500">Belum ada yang melamar untuk lowongan ini.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right Column: Job Details + Image -->
                                <div class="md:col-span-1 space-y-6">
                                    <div class="bg-white rounded-lg shadow-sm p-8">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Detail Pekerjaan</h2>
                                        <div id="jobDetailsContainer" class="space-y-6">
                                            <p>Loading...</p>
                                        </div>
                                    </div>

                                    <!-- Job Image -->
                                    <div id="jobImageContainer" class="bg-white rounded-lg shadow-sm p-8">
                                        <div class="flex justify-center items-center h-48">
                                            <div class="animate-pulse flex space-x-4">
                                                <div class="rounded-md bg-gray-200 h-24 w-24"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resume Preview Modal -->
    <div id="resumeModal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-screen overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900">CV/Resume Pelamar</h3>
                <button onclick="closeResumeModal()" class="text-gray-400 hover:text-gray-500">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: 80vh;">
                <div id="resumeContent" class="w-full h-full">
                    <!-- Resume content will be loaded here -->
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                <button onclick="closeResumeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variable for job data
        let currentJob = null;

        // Get job ID from URL parameters
        function getJobIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Show loading indicator
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }

        // Hide loading indicator
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // Show success message
        function showSuccessMessage(message) {
            const successDiv = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            
            successText.textContent = message;
            successDiv.classList.remove('hidden');
            
            // Hide error message if visible
            document.getElementById('errorMessage').classList.add('hidden');
            
            setTimeout(() => {
                successDiv.classList.add('hidden');
            }, 5000);
        }

        // Show error message
        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
            
            // Hide success message if visible
            document.getElementById('successMessage').classList.add('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        // Fetch job detail from API using axios
        async function fetchJobDetail(jobId) {
            showLoading();
            try {
                const response = await axios.get(`/api/jobs/${jobId}`);
                currentJob = response.data;
                displayJobDetail(currentJob);
                fetchApplicants(jobId);
                hideLoading();
                document.getElementById('jobDetailContent').classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching job detail:', error);
                hideLoading();
                showJobError(`Gagal memuat detail lowongan kerja. Status: ${error.response?.status || 'Unknown'}`);
            }
        }

        // Display job detail
        function displayJobDetail(job) {
            // Update page title
            document.title = `${job.title} - Bursa Talenta Admin`;
            
            // Update breadcrumb
            const breadcrumbSpan = document.querySelector('nav ol li:last-child span');
            breadcrumbSpan.textContent = job.title;
            
            // Update job title and company
            document.getElementById('jobTitle').textContent = job.title;
            document.getElementById('companyName').textContent = job.company_name;
            
            // Update job description
            document.getElementById('jobDescription').innerHTML = `<p>${job.description}</p>`;
            
            // Update job details dynamically
            updateJobDetailsContainer(job);
            
            // Update job image if available
            updateJobImage(job);
        }

        // Update job details container
        function updateJobDetailsContainer(job) {
            const jobDetailsContainer = document.getElementById('jobDetailsContainer');
            
            // Determine if job should be opened based on approval status
            // If job is approved, it can be opened, otherwise it should be closed
            let canBeOpened = job.is_approved === true;
            
            // If job is pending approval or rejected, force is_opened to false
            if (job.is_approved === null || job.is_approved === false) {
                if (job.is_opened) {
                    // Only log if we're changing the status
                    console.log('Job status forced to closed due to approval status');
                }
                job.is_opened = false;
            }
            
            jobDetailsContainer.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                        </svg>
                        <div>
                            <span class="text-sm font-medium text-gray-900">Lokasi:</span>
                            <span class="text-sm text-gray-600 ml-2">${job.location || 'Remote'}</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd" />
                        </svg>
                        <div>
                            <span class="text-sm font-medium text-gray-900">Gaji:</span>
                            <span class="text-sm text-gray-600 ml-2">${formatSalary(job.salary)}</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                        </svg>
                        <div>
                            <span class="text-sm font-medium text-gray-900">Jenis:</span>
                            <span class="text-sm text-gray-600 ml-2">${job.type}</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        <div>
                            <span class="text-sm font-medium text-gray-900">Status:</span>
                            <span class="text-sm ${job.is_approved ? 'text-green-600' : job.is_approved === null ? 'text-yellow-600' : 'text-red-600'} ml-2 font-medium">
                                ${job.is_approved === null ? 'Menunggu Persetujuan' : job.is_approved ? 'Disetujui' : 'Ditolak'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        <div>
                            <span class="text-sm font-medium text-gray-900">Status Lowongan:</span>
                            <span class="text-sm ${job.is_opened ? 'text-green-600' : 'text-red-600'} ml-2 font-medium">
                                ${job.is_opened ? 'Terbuka' : 'Ditutup'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                        </svg>
                        <div>
                            <span class="text-sm font-medium text-gray-900">Dibuat:</span>
                            <span class="text-sm text-gray-600 ml-2">${formatDate(job.created_at)}</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                        </svg>
                        <div>
                            <span class="text-sm font-medium text-gray-900">Diperbarui:</span>
                            <span class="text-sm text-gray-600 ml-2">${formatDate(job.updated_at)}</span>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        ${canBeOpened ? `
                            <button id="closeJobBtn" onclick="closeJob()" class="${job.is_opened ? 'bg-yellow-500 hover:bg-yellow-700' : 'bg-green-500 hover:bg-green-700'} text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                ${job.is_opened ? 'Tutup Lowongan' : 'Buka Lowongan'}
                            </button>
                        ` : `
                            <div class="text-sm text-gray-600 italic">
                                Lowongan tidak dapat dibuka karena ${job.is_approved === null ? 'masih menunggu persetujuan' : 'telah ditolak'}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Update job image
        function updateJobImage(job) {
            const imageContainer = document.getElementById('jobImageContainer');

            const imageUrl = job.image;
            
            imageContainer.innerHTML = `
                <div class="flex justify-center items-center h-64">
                    <img src="${imageUrl}" alt="${job.title || 'Job'}" class="max-h-full max-w-full object-contain rounded-lg">
                </div>
            `;
            imageContainer.className = 'bg-white rounded-lg shadow-sm p-8';
        }

        // Fetch applicants for this job
        async function fetchApplicants(jobId) {
            try {
                const response = await axios.get(`/api/applicants/job/${jobId}`);
                const applicants = response.data;
                displayApplicants(applicants);
            } catch (error) {
                console.error('Error fetching applicants:', error);
                showErrorMessage('Gagal memuat data pelamar: ' + (error.response?.data?.message || error.message));
            }
        }

        // Display applicants
        function displayApplicants(applicants) {
            const totalApplicantsElement = document.getElementById('totalApplicants');
            const applicantsTableBody = document.getElementById('applicantsTableBody');
            const noApplicantsMessage = document.getElementById('noApplicantsMessage');
            
            // Update total applicants count
            totalApplicantsElement.textContent = applicants.length;
            
            // Clear previous content
            applicantsTableBody.innerHTML = '';
            
            // Show/hide empty state message
            if (applicants.length === 0) {
                noApplicantsMessage.classList.remove('hidden');
                applicantsTableBody.parentElement.parentElement.classList.add('hidden');
                return;
            } else {
                noApplicantsMessage.classList.add('hidden');
                applicantsTableBody.parentElement.parentElement.classList.remove('hidden');
            }
            
            // Populate table with applicants
            applicants.forEach(applicant => {
                const row = document.createElement('tr');
                
                // Format date
                const appliedDate = formatDate(applicant.applied_at);
                
                // Status badge
                let statusBadge = '';
                switch (applicant.status) {
                    case 'success':
                        statusBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Berhasil</span>';
                        break;
                    case 'pending':
                        statusBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Menunggu</span>';
                        break;
                    case 'rejected':
                        statusBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Ditolak</span>';
                        break;
                    default:
                        statusBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Unknown</span>';
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10">
                                <img class="h-10 w-10 rounded-full" src="${applicant.user.photo}" alt="">
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${applicant.user.name}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${applicant.user.email}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${appliedDate}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">
                            Rp ${formatNumber(applicant.salary_expectation_min)} - Rp ${formatNumber(applicant.salary_expectation_max)}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${statusBadge}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button onclick="viewResume('${applicant.resume}')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                            <svg class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            Lihat CV
                        </button>
                    </td>
                `;
                
                applicantsTableBody.appendChild(row);
            });
        }

        // View resume
        function viewResume(resumeUrl) {
            const resumeContent = document.getElementById('resumeContent');
            const resumeModal = document.getElementById('resumeModal');
            
            // Check file extension
            const fileExtension = resumeUrl.split('.').pop().toLowerCase();
            
            if (fileExtension === 'pdf') {
                // For PDF files, use iframe
                resumeContent.innerHTML = `
                    <iframe src="${resumeUrl}" width="100%" height="600px" style="border: none;"></iframe>
                `;
            } else if (['doc', 'docx'].includes(fileExtension)) {
                // For Word documents, use Google Docs Viewer or provide download link
                resumeContent.innerHTML = `
                    <div class="text-center">
                        <p class="mb-4">Dokumen Word tidak dapat ditampilkan langsung. Silakan unduh file.</p>
                        <a href="${resumeUrl}" download class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Unduh CV
                        </a>
                    </div>
                `;
            } else {
                // For other file types
                resumeContent.innerHTML = `
                    <div class="text-center">
                        <p class="mb-4">Format file tidak didukung untuk pratinjau. Silakan unduh file.</p>
                        <a href="${resumeUrl}" download class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Unduh CV
                        </a>
                    </div>
                `;
            }
            
            // Show modal
            resumeModal.classList.remove('hidden');
        }

        // Close resume modal
        function closeResumeModal() {
            document.getElementById('resumeModal').classList.add('hidden');
        }

        // Edit job
        function editJob() {
            if (currentJob) {
                window.location.href = `/admin/edit-job?id=${currentJob.id}`;
            }
        }

        // Delete job
        function deleteJob() {
            if (!currentJob) return;
            
            showConfirmationModal(
                'Hapus Lowongan',
                'Apakah Anda yakin ingin menghapus lowongan ini? Tindakan ini tidak dapat dibatalkan.',
                async () => {
                    showLoading();
                    try {
                        await axios.delete(`/api/jobs/${currentJob.id}`);
                        showSuccessMessage('Lowongan berhasil dihapus');
                        
                        // Redirect to job management page after short delay
                        setTimeout(() => {
                            window.location.href = '/view/admin/job-management.html';
                        }, 2000);
                    } catch (error) {
                        console.error('Error deleting job:', error);
                        hideLoading();
                        showErrorMessage('Gagal menghapus lowongan: ' + (error.response?.data?.message || error.message));
                    }
                }
            );
        }
        
        // Show confirmation modal
        function showConfirmationModal(title, message, confirmCallback) {
            const modal = document.getElementById('confirmationModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const confirmButton = document.getElementById('confirmButton');
            const cancelButton = document.getElementById('cancelButton');
            
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            
            // Remove previous event listeners
            const newConfirmButton = confirmButton.cloneNode(true);
            const newCancelButton = cancelButton.cloneNode(true);
            confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
            cancelButton.parentNode.replaceChild(newCancelButton, cancelButton);
            
            // Add new event listeners
            newConfirmButton.addEventListener('click', () => {
                modal.classList.add('hidden');
                confirmCallback();
            });
            
            newCancelButton.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
            
            // Show modal
            modal.classList.remove('hidden');
        }
        
        // Close job (toggle is_opened status)
        function closeJob() {
            if (!currentJob) return;
            
            const action = currentJob.is_opened ? 'menutup' : 'membuka';
            const newStatus = !currentJob.is_opened;
            
            showConfirmationModal(
                `${newStatus ? 'Buka' : 'Tutup'} Lowongan`,
                `Apakah Anda yakin ingin ${action} lowongan ini?`,
                async () => {
                    showLoading();
                    try {
                        await axios.put(`/api/jobs/${currentJob.id}/toggle-status`, {
                            is_opened: newStatus
                        });
                        
                        // Update current job data
                        currentJob.is_opened = newStatus;
                        
                        // Update UI
                        updateJobDetailsContainer(currentJob);
                        
                        showSuccessMessage(`Lowongan berhasil ${newStatus ? 'dibuka' : 'ditutup'}`);
                        hideLoading();
                    } catch (error) {
                        console.error('Error toggling job status:', error);
                        hideLoading();
                        showErrorMessage(`Gagal ${action} lowongan: ` + (error.response?.data?.message || error.message));
                    }
                }
            );
        }

        // Show error message for job loading failure
        function showJobError(message) {
            const mainContent = document.querySelector('.max-w-7xl');
            mainContent.innerHTML = `
                <div class="bg-white rounded-lg shadow-sm p-8 text-center">
                    <div class="text-red-500 text-6xl mb-4">⚠️</div>
                    <h1 class="text-2xl font-bold text-gray-900 mb-4">Error</h1>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <a href="/view/admin/job-management.html" 
                       class="bg-custom-blue hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Kembali ke Manajemen Lowongan
                    </a>
                </div>
            `;
        }

        // Format salary
        function formatSalary(salary) {
            if (!salary) return 'Tidak disebutkan';
            return `Rp ${formatNumber(salary)}`;
        }

        // Format number with thousand separator
        function formatNumber(number) {
            return parseInt(number).toLocaleString('id-ID');
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const jobId = getJobIdFromUrl();
            if (!jobId) {
                showJobError('ID lowongan tidak ditemukan.');
                return;
            }
            
            // Fetch job detail
            fetchJobDetail(jobId);
            
            // Close modal when clicking outside
            const resumeModal = document.getElementById('resumeModal');
            window.addEventListener('click', function(event) {
                if (event.target === resumeModal) {
                    closeResumeModal();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeResumeModal();
                }
            });
        });
    </script>
    
    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
            <div class="mb-4">
                <h3 id="modalTitle" class="text-lg font-medium text-gray-900">Konfirmasi</h3>
            </div>
            <div class="mb-6">
                <p id="modalMessage" class="text-sm text-gray-600">Apakah Anda yakin?</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancelButton" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
                    Batal
                </button>
                <button id="confirmButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Konfirmasi
                </button>
            </div>
        </div>
    </div>
</body>

</html>